namespace: netbird-operator

resources:
  - ../../base/netbird-operator/
  - namespace.yaml
  - secrets.yaml

#patches:
#  # replace netbird-management url, cluster name
#  - target:
#     kind: Deployment
#      name: netbird-operator-kubernetes-operator
#    patch: |
#      apiVersion: apps/v1
#      kind: Deployment
#      metadata:
#        name: netbird-operator-kubernetes-operator
#      spec:
#        template:
#          spec:
#            containers:
#              - name: kubernetes-operator
#                args:
#                  - /manager
#                  - --metrics-bind-address=:8080
#                  - --leader-elect
#                  - --health-probe-bind-address=:8081
#                  - --webhook-cert-path=/tmp/k8s-webhook-server/serving-certs
#                  - --netbird-management-url=https://netbird.fingol.pro
#                  - --cluster-name=k3ext
#                  - --cluster-dns=svc.cluster.local
#                  - --netbird-api-key=$(NB_API_KEY)
#                  - --allow-automatic-policy-creation
#
#  # replace cluster name
#  - target:
#      kind: Job
#      name: netbird-operator-kubernetes-operator-kubernetes-service-expose
#    patch: |
#      apiVersion: batch/v1
#      kind: Job
#      metadata:
#        name: netbird-operator-kubernetes-operator-kubernetes-service-expose
#      spec:
#        template:
#          spec:
#            containers:
#              - name: apply-nbresource
#                env:
#                  - name: NBRESOURCE_VALUE
#                    value: |
#                      apiVersion: netbird.io/v1
#                      kind: NBResource
#                      metadata:
#                        finalizers:
#                        - netbird.io/cleanup
#                        name: kubernetes
#                        namespace: default
#                      spec:
#                        address: kubernetes.default.svc.cluster.local
#                        groups:
#                        - k3ext-default-api-access
#                        name: default-kubernetes-api
#                        networkID: ${NETWORK_ID}
#                        tcpPorts:
#                        - 443
